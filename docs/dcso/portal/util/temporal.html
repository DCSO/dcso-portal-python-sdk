<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.1" />
<title>dcso.portal.util.temporal API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>dcso.portal.util.temporal</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python"># Copyright (c) 2020, DCSO GmbH

from datetime import datetime, timedelta, timezone


def utc_now() -&gt; datetime:
    &#34;&#34;&#34;Returns now as non-naive UTC `datetime.datetime` instance.&#34;&#34;&#34;
    return datetime.utcnow().replace(tzinfo=timezone.utc)


def diff_utc_now(dt: datetime) -&gt; timedelta:
    &#34;&#34;&#34;Returns difference between now UTC and the given datetime `dt`.

    A positive time delta means dt comes after current UTC time stamp.
    If dt is naive, timezone is first set, assuming it to be UTC.
    &#34;&#34;&#34;
    if not dt.timetz():
        dt.replace(tzinfo=timezone.utc)

    return dt - utc_now()


def decode_utc_iso8601(s: str) -&gt; datetime:
    &#34;&#34;&#34;Decodes a UTC ISO 8601 formatted timestamp and returns it as a
    non-naive `datetime.datetime` instance.

    Since the Python method datetime.fromisoformat does only support
    timezone designator offsets, we must translate zone designators.

    The &#39;Z&#39; and &#39; UTC&#39; (note space) zone designators are translated
    as &#39;+00:00&#39;.

    Any timestamp that does not contain a timezone designator, offset
    or name, or is not UTC, is considered invalid and ValueError is raised.

    Note that only microsecond precision is supported. For example,
    nanoseconds will be truncated and rounded till microseconds.
    &#34;&#34;&#34;
    zero_hour = &#39;+00:00&#39;
    try:
        if not s[-6:] == zero_hour:
            if s[-1:] == &#39;Z&#39;:
                s = s.replace(&#39;Z&#39;, zero_hour)
            elif s[-4:] == &#39; UTC&#39;:
                s = s.replace(&#39; UTC&#39;, zero_hour)
            elif s[-3:] == &#39;+00&#39;:
                s = s.replace(&#39;+00&#39;, zero_hour)
            else:
                raise ValueError(&#34;timezone UTC not recognized&#34;)
        dot_index = s.index(&#39;.&#39;)
        tz_index = s.index(&#39;+&#39;)
        if dot_index &gt; 0 and tz_index &gt; dot_index + 7:
            # we make sure that the fraction has 6 digits
            # allowing microseconds, but not nanoseconds
            fraction = s[dot_index + 1:tz_index]
            s = s.replace(&#39;.&#39; + fraction, &#39;.&#39; + str(round(int(fraction) / 1000)))
        try:
            return datetime.fromisoformat(s)
        except AttributeError:
            # for Python 3.6
            return fromisoformat(s)
    except (ValueError, TypeError):
        raise ValueError


def fromisoformat(date_string: str) -&gt; datetime:
    &#34;&#34;&#34;Construct a datetime from the output of datetime.isoformat().

    Back-ported and inspired from Python 3.7, including helper functions.

    https://github.com/python/cpython/blob/3.7/Lib/datetime.py
    &#34;&#34;&#34;
    if not isinstance(date_string, str):
        raise TypeError(&#39;fromisoformat: argument must be str&#39;)

    # Split this at the separator
    dstr = date_string[0:10]
    tstr = date_string[11:]

    try:
        date_components = _parse_isoformat_date(dstr)
    except ValueError:
        raise ValueError(f&#39;Invalid isoformat string: {date_string!r}&#39;)

    if tstr:
        try:
            time_components = _parse_isoformat_time(tstr)
        except ValueError:
            raise ValueError(f&#39;Invalid isoformat string: {date_string!r}&#39;)
    else:
        time_components = [0, 0, 0, 0, None]

    return datetime(*(date_components + time_components))


# Helpers for parsing the result of isoformat()
def _parse_isoformat_date(dtstr):
    # It is assumed that this function will only be called with a
    # string of length exactly 10, and (though this is not used) ASCII-only
    year = int(dtstr[0:4])
    if dtstr[4] != &#39;-&#39;:
        raise ValueError(&#39;Invalid date separator: %s&#39; % dtstr[4])

    month = int(dtstr[5:7])

    if dtstr[7] != &#39;-&#39;:
        raise ValueError(&#39;Invalid date separator&#39;)

    day = int(dtstr[8:10])

    return [year, month, day]


def _parse_isoformat_time(tstr):
    # Format supported is HH[:MM[:SS[.fff[fff]]]][+HH:MM[:SS[.ffffff]]]
    len_str = len(tstr)
    if len_str &lt; 2:
        raise ValueError(&#39;Isoformat time too short&#39;)

    # This is equivalent to re.search(&#39;[+-]&#39;, tstr), but faster
    tz_pos = (tstr.find(&#39;-&#39;) + 1 or tstr.find(&#39;+&#39;) + 1)
    timestr = tstr[:tz_pos - 1] if tz_pos &gt; 0 else tstr

    time_comps = _parse_hh_mm_ss_ff(timestr)

    tzi = None
    if tz_pos &gt; 0:
        tzstr = tstr[tz_pos:]

        # Valid time zone strings are:
        # HH:MM               len: 5
        # HH:MM:SS            len: 8
        # HH:MM:SS.ffffff     len: 15

        if len(tzstr) not in (5, 8, 15):
            raise ValueError(&#39;Malformed time zone string&#39;)

        tz_comps = _parse_hh_mm_ss_ff(tzstr)
        if all(x == 0 for x in tz_comps):
            tzi = timezone.utc
        else:
            tzsign = -1 if tstr[tz_pos - 1] == &#39;-&#39; else 1

            td = timedelta(hours=tz_comps[0], minutes=tz_comps[1],
                           seconds=tz_comps[2], microseconds=tz_comps[3])

            tzi = timezone(tzsign * td)

    time_comps.append(tzi)

    return time_comps


def _parse_hh_mm_ss_ff(tstr):
    # Parses things of the form HH[:MM[:SS[.fff[fff]]]]
    len_str = len(tstr)

    time_comps = [0, 0, 0, 0]
    pos = 0
    for comp in range(0, 3):
        if (len_str - pos) &lt; 2:
            raise ValueError(&#39;Incomplete time component&#39;)

        time_comps[comp] = int(tstr[pos:pos + 2])

        pos += 2
        next_char = tstr[pos:pos + 1]

        if not next_char or comp &gt;= 2:
            break

        if next_char != &#39;:&#39;:
            raise ValueError(&#39;Invalid time separator: %c&#39; % next_char)

        pos += 1

    if pos &lt; len_str:
        if tstr[pos] != &#39;.&#39;:
            raise ValueError(&#39;Invalid microsecond component&#39;)
        else:
            pos += 1

            len_remainder = len_str - pos
            if len_remainder not in (3, 6):
                raise ValueError(&#39;Invalid microsecond component&#39;)

            time_comps[3] = int(tstr[pos:])
            if len_remainder == 3:
                time_comps[3] *= 1000

    return time_comps</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="dcso.portal.util.temporal.decode_utc_iso8601"><code class="name flex">
<span>def <span class="ident">decode_utc_iso8601</span></span>(<span>s: str) ‑> datetime.datetime</span>
</code></dt>
<dd>
<div class="desc"><p>Decodes a UTC ISO 8601 formatted timestamp and returns it as a
non-naive <code>datetime.datetime</code> instance.</p>
<p>Since the Python method datetime.fromisoformat does only support
timezone designator offsets, we must translate zone designators.</p>
<p>The 'Z' and ' UTC' (note space) zone designators are translated
as '+00:00'.</p>
<p>Any timestamp that does not contain a timezone designator, offset
or name, or is not UTC, is considered invalid and ValueError is raised.</p>
<p>Note that only microsecond precision is supported. For example,
nanoseconds will be truncated and rounded till microseconds.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def decode_utc_iso8601(s: str) -&gt; datetime:
    &#34;&#34;&#34;Decodes a UTC ISO 8601 formatted timestamp and returns it as a
    non-naive `datetime.datetime` instance.

    Since the Python method datetime.fromisoformat does only support
    timezone designator offsets, we must translate zone designators.

    The &#39;Z&#39; and &#39; UTC&#39; (note space) zone designators are translated
    as &#39;+00:00&#39;.

    Any timestamp that does not contain a timezone designator, offset
    or name, or is not UTC, is considered invalid and ValueError is raised.

    Note that only microsecond precision is supported. For example,
    nanoseconds will be truncated and rounded till microseconds.
    &#34;&#34;&#34;
    zero_hour = &#39;+00:00&#39;
    try:
        if not s[-6:] == zero_hour:
            if s[-1:] == &#39;Z&#39;:
                s = s.replace(&#39;Z&#39;, zero_hour)
            elif s[-4:] == &#39; UTC&#39;:
                s = s.replace(&#39; UTC&#39;, zero_hour)
            elif s[-3:] == &#39;+00&#39;:
                s = s.replace(&#39;+00&#39;, zero_hour)
            else:
                raise ValueError(&#34;timezone UTC not recognized&#34;)
        dot_index = s.index(&#39;.&#39;)
        tz_index = s.index(&#39;+&#39;)
        if dot_index &gt; 0 and tz_index &gt; dot_index + 7:
            # we make sure that the fraction has 6 digits
            # allowing microseconds, but not nanoseconds
            fraction = s[dot_index + 1:tz_index]
            s = s.replace(&#39;.&#39; + fraction, &#39;.&#39; + str(round(int(fraction) / 1000)))
        try:
            return datetime.fromisoformat(s)
        except AttributeError:
            # for Python 3.6
            return fromisoformat(s)
    except (ValueError, TypeError):
        raise ValueError</code></pre>
</details>
</dd>
<dt id="dcso.portal.util.temporal.diff_utc_now"><code class="name flex">
<span>def <span class="ident">diff_utc_now</span></span>(<span>dt: datetime.datetime) ‑> datetime.timedelta</span>
</code></dt>
<dd>
<div class="desc"><p>Returns difference between now UTC and the given datetime <code>dt</code>.</p>
<p>A positive time delta means dt comes after current UTC time stamp.
If dt is naive, timezone is first set, assuming it to be UTC.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def diff_utc_now(dt: datetime) -&gt; timedelta:
    &#34;&#34;&#34;Returns difference between now UTC and the given datetime `dt`.

    A positive time delta means dt comes after current UTC time stamp.
    If dt is naive, timezone is first set, assuming it to be UTC.
    &#34;&#34;&#34;
    if not dt.timetz():
        dt.replace(tzinfo=timezone.utc)

    return dt - utc_now()</code></pre>
</details>
</dd>
<dt id="dcso.portal.util.temporal.fromisoformat"><code class="name flex">
<span>def <span class="ident">fromisoformat</span></span>(<span>date_string: str) ‑> datetime.datetime</span>
</code></dt>
<dd>
<div class="desc"><p>Construct a datetime from the output of datetime.isoformat().</p>
<p>Back-ported and inspired from Python 3.7, including helper functions.</p>
<p><a href="https://github.com/python/cpython/blob/3.7/Lib/datetime.py">https://github.com/python/cpython/blob/3.7/Lib/datetime.py</a></p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def fromisoformat(date_string: str) -&gt; datetime:
    &#34;&#34;&#34;Construct a datetime from the output of datetime.isoformat().

    Back-ported and inspired from Python 3.7, including helper functions.

    https://github.com/python/cpython/blob/3.7/Lib/datetime.py
    &#34;&#34;&#34;
    if not isinstance(date_string, str):
        raise TypeError(&#39;fromisoformat: argument must be str&#39;)

    # Split this at the separator
    dstr = date_string[0:10]
    tstr = date_string[11:]

    try:
        date_components = _parse_isoformat_date(dstr)
    except ValueError:
        raise ValueError(f&#39;Invalid isoformat string: {date_string!r}&#39;)

    if tstr:
        try:
            time_components = _parse_isoformat_time(tstr)
        except ValueError:
            raise ValueError(f&#39;Invalid isoformat string: {date_string!r}&#39;)
    else:
        time_components = [0, 0, 0, 0, None]

    return datetime(*(date_components + time_components))</code></pre>
</details>
</dd>
<dt id="dcso.portal.util.temporal.utc_now"><code class="name flex">
<span>def <span class="ident">utc_now</span></span>(<span>) ‑> datetime.datetime</span>
</code></dt>
<dd>
<div class="desc"><p>Returns now as non-naive UTC <code>datetime.datetime</code> instance.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def utc_now() -&gt; datetime:
    &#34;&#34;&#34;Returns now as non-naive UTC `datetime.datetime` instance.&#34;&#34;&#34;
    return datetime.utcnow().replace(tzinfo=timezone.utc)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<header>
<a class="homelink" rel="home" title="pdoc Home" href="https://dcso.de">
<img src="https://avatars1.githubusercontent.com/u/17251161?s=200&v=4" width="52"> DCSO</a> Portal Python SDK
</header>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="dcso.portal.util" href="index.html">dcso.portal.util</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="dcso.portal.util.temporal.decode_utc_iso8601" href="#dcso.portal.util.temporal.decode_utc_iso8601">decode_utc_iso8601</a></code></li>
<li><code><a title="dcso.portal.util.temporal.diff_utc_now" href="#dcso.portal.util.temporal.diff_utc_now">diff_utc_now</a></code></li>
<li><code><a title="dcso.portal.util.temporal.fromisoformat" href="#dcso.portal.util.temporal.fromisoformat">fromisoformat</a></code></li>
<li><code><a title="dcso.portal.util.temporal.utc_now" href="#dcso.portal.util.temporal.utc_now">utc_now</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<div style="width: 100%; display: flex; justify-content: flex-end">
<div>
<p>Copyright (c) 2020, <a href="https://dcso.de">DCSO Deutsche Cyber-Sicherheitsorganisation GmbH</a></p>
</div>
<div>
<p><strong>v1.0.0-beta3</strong></p>
</div>
</div>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/dcso/dcso-portal-python-sdk" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#70B7FD; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
</footer>
</body>
</html>